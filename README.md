# arduRIO: CompactRIO with C/C++ Arduino-like Syntax

## Description
This repository provides an abstraction layer to program any NI CompactRIO in C/C++ with an Arduino-like syntax. It allows for the dynamic creation of FPGA I/O nodes accessors based on the C Series Modules you have in your cRIO.

## Table of Contents
1. Important Usage Limitations and Clarifications
2. Requirments
3. Installation
4. Usage

## Important Usage Limitations and Clarifications
 This software is primarily intended for demonstration purposes. It's important to understand that the cRIO is not a microcontroller. It is a powerful embedded computer that is programmed on its own and runs Linux RT. While this software provides an Arduino-like syntax for ease of use, it does not fully utilize the extensive capabilities of the cRIO. For instance, this software is designed to work only with analog and digital C Series Modules.

LabVIEW is needed to generate the bitfile but as long as you don't change hardware there is no need to go back to LabVIEW. No knowledge of G code programming is required.

### Current supported functions
- analogRead
- analogWrite
- digitalWrite
- digitalRead
- millis
- micros
- delay

## Requirments
1. [LabVIEW 32-bit Full or Professional](https://www.ni.com/en/support/downloads/software-products/download.labview.html?cid=PSEA-7013q000001fLK5AAM-CONS-GOGSE_161597904920&utm_keyword=labview&gad_source=1&gclid=Cj0KCQjw0MexBhD3ARIsAEI3WHJJsbhO7ZvzJ5xcJvW01WwYK918yAw1gjPAeJdG61ADrE_NOkB35dMaApt1EALw_wcB#521715&s_kwcid=AL!6304!3!691563588225!b!!g!!labview). Version 2024Q1 or newer with [Real-Time Module](https://www.ni.com/en/support/downloads/software-products/download.labview-real-time-module.html#521698) and [FPGA Module](https://www.ni.com/en/support/downloads/software-products/download.labview-fpga-module.html#521573)
2. Any CompactRIO controller and its respective [driver](https://www.ni.com/en/support/downloads/drivers/download.ni-compactrio.html#521567)
3. One of each digital I/O and analog I/O [C Series digital or analog module](https://www.ni.com/en/shop/compactrio/compactrio-modules.html?cid=PSEA-7013q000001fLK0AAM-CONS-GOGSE_150020924350&utm_keyword=compactrio&gad_source=1&gclid=Cj0KCQjw0MexBhD3ARIsAEI3WHJiXqoEIcHlKRhIbWARgY2qKxSminZvY4gc-yZFIB_ykB0WXxAeSl0aAh8UEALw_wcB).

## Installation
Fist you will need to copy this repository to your development computer

`git clone https://github.com/Hunajpu/arduRIO`

To start programing the cRIO with C/C++ Arduino syntax, we need to generate an FPGA bitfile and then the C FPGA interface files. Inside the LabVIEW folder there is a project with the necesary tools for this. To create new files there is a four steps cycle tha you will need to run every time you change the hardware on the cRIO:
1. Project configuration.
2. Bitfile generation.
3. C FPGA code generation.
4. Coping files to the target CompactRIO

### 1. Project configuration
1. Open the scriptFPGAioSelectors LabVIEW project inside the LabVIEW folder
2. Right-click the Project icon and create a new Target
![New project target](/LabVIEW/images/NewTarget.png)
3. Expand the Real-Time CompactRIO folder to discover all the cRIO remote devices available. Select your device and click on OK.
![Add Existing Target](/LabVIEW/images/AddExistingTarget.png)
4. Expand the recently added cRIO and Chassis
5. Right-click on the Chassis item and add a new FPGA target
![Add FPGA target](/LabVIEW/images/AddFPGAtarget.png)
6. Expand the RT CompactRIO Target, Chassis and FPGA Target
7. Copy the Counters folder and all the VIs and LabVIEW controls
![Copy VIs](/LabVIEW/images/CopyVIs.png)
8. Paste the elements under the FPGA target of the recently added cRIO
![Paste VIs](/LabVIEW/images/PasteVIs.png)
9. Now you can remove the RT CompactRIO Target from the project. Right-click->Remove from Project
10. If you already have modules under Real-Time Scan Resources or Real-Time Resources remove them from the project.
11. Right-click on the FPGA Target->New->C Series Modules...
![New C modules](/LabVIEW/images/NewCmodules.png)
13. Expand the C Series Module folder on the pop-up window and select all the modules you want. This project only works with Digital or Analog modules.
![Select Modules](/LabVIEW/images/SelectModules.png)
14. Open the MainScriptCreateAllIOselectors.vi that is under My Computer
15. Run the VI. This process may take a few minutes to complete

### 2. Bitfile generation 
1. Right-click on the FPGA Build Specifications and create a new compilation
2. Under Source Files select fpga_main.vi. The rest of the configurations can be left with the default values
3. Click on build.

### 3. C FPGA code generation
These files need to be generated by running the LabVIEW C API generator
1. Right-click the fpga_main.vi on the project and Launch the C API generator
![C API generator](/LabVIEW/images/launchCgenerator.png)
2. Make sure that the generated files are save to arduRIO/generated
3. Set the Prefix Override to f and the target Platform to Linux RT
![C API generator options](/LabVIEW/images/APIGeneratorOptions.png)

### 4. Coping files to the target CompactRIO
- Copy all the files from the arduRIO folder to the target cRIO. [Tools Available for File Transfer/Access on NI Linux Real-Time Targets](https://knowledge.ni.com/KnowledgeArticleDetails?id=kA03q000000YMLnCAO&l=en-US)
- You can use scp command to send the folder from Windows to the cRIO
`scp -r \path\to\arduRIO admin@cRIO_IP:/home/admin/arduRIO`

## Usage

Once you hace the folder in the cRIO you can remote access it and modify the Blink.ino file to program whatever you want, then compile it running the make command
`$ make`
This will generate an executable with the same name
`$ ./Blink`